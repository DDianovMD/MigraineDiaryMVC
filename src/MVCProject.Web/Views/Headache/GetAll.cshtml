@model PaginatedList<RegisteredHeadacheViewModel>

@{
    ViewData["Title"] = "Headaches";
    ViewData["PartialViewController"] = "Headache";
    ViewData["PartialViewAction"] = "GetAll";
    ViewData["itemsType"] = "Главоболия";

    int headacheCounter = 1;
    string currentUserId = User.FindFirstValue(ClaimTypes.NameIdentifier);
}

<main>
    <section>
        @if (Model.Count > 0)
        {
            <h3 class="text-center">Регистрирани главоболия</h3>
            <partial name="_PageItemsOrderingNavigation" view-data="ViewData" />
            <div class="container mt-4">
                <div class="row">
                    @foreach (var headache in Model)
                    {
                        <h4 class="text-center article-title">Главоболие № @(headacheCounter * Model.CurrentPageIndex)</h4>
                        <hr />
                        <input type="hidden" id="headacheID-@headacheCounter" value="@headache.Id">
                        <p>
                            Начало на главоболието: @headache.Onset.TimeOfDay.ToString().Substring(0, 5) ч. на
                            @headache.Onset.ToShortDateString()
                        </p>
                        <p>
                            Край на главоболието: @headache.EndTime.TimeOfDay.ToString().Substring(0, 5) ч. на
                            @headache.EndTime.ToShortDateString()
                        </p>
                        <p>Продължителност на главоболието: @headache.DurationDays @(headache.DurationDays == 1 ? "ден" : "дни"), @headache.DurationHours @(headache.DurationHours == 1 ? "час" : "часа") и @headache.DurationMinutes минути</p>
                        <p>Сила на болката (0-10): @headache.Severity</p>
                        <p>Локализация на болката: @headache.LocalizationSide</p>
                        <p>Характеристика на болката: @headache.PainCharacteristics</p>
                        <p>Фотофобия: @(headache.Photophoby == true ? "да" : "не")</p>
                        <p>Фонофобия: @(headache.Phonophoby == true ? "да" : "не")</p>
                        <p>Гадене: @(headache.Nausea == true ? "да" : "не")</p>
                        <p>Повръщане: @(headache.Vomiting == true ? "да" : "не")</p>
                        <p>Наличие на аура: @(headache.Vomiting == true ? "да" : "не")</p>

                        @if (headache.Aura == true)
                        {
                            <p>Описание на аурата: @(headache.AuraDescriptionNotes != null ? headache.AuraDescriptionNotes : "липсва oписание") </p>
                        }

                        <p>Провокиращи главоболието фактори: @(headache.Triggers != null ? headache.Triggers : "липсват данни")</p>

                        @if (headache.UsedMedications.Count() == 0)
                        {
                            <p>Употребени медикаменти: липсват данни</p>
                        }
                        else
                        {
                            <p>Употребени медикаменти:</p>
                            <ul style="margin-left: 50px">
                                @for (int i = 0; i < headache.UsedMedications.Count(); i++)
                                {
                                    var medication = @headache.UsedMedications.ElementAt(i);

                                    <li>@medication.Name @medication.SinglePillDosage @medication.Units - @($"{@medication.DosageTaken:F2}") @medication.Units</li>
                                }
                            </ul>
                        }

                        @if (headache.Doctors.Count() > 0)
                        {
                            <p>
                                Споделено с:
                                @foreach (var doctor in headache.Doctors.OrderBy(x => x.FirstName).ThenBy(x => x.LastName))
                                {
                                    <span>Д-р @doctor.FirstName @doctor.LastName </span>
                                }
                            </p>
                        }

                        <div>
                            <span>Сподели с: </span>
                            <input type="text" id="searchBar-@headacheCounter" placeholder="Намери лекар..." oninput="searchDoctor(@headacheCounter);" class="searchBar" />
                            <span id="share-headache-btn-@headacheCounter" class="btn btn-success share-headache-btn">Сподели</span>
                            <div id="searchResult-@headacheCounter"></div>
                        </div>
                        <div class="mt-2">
                            <button type="button" class="btn btn-primary" onclick="removeSearchResults(@headacheCounter);" style="margin-left: 132px;">Изчисти</button>
                        </div>
                        headacheCounter++;
                    }
                </div>
            </div>
        }
        else
        {
            <div>
                <p>Изглежда все още нямате регистрирани главоболия. Защо не регистрирате първото си главоболие от <a asp-controller="Headache" asp-action="Add" asp-route-id=@currentUserId>тук</a>?</p>
            </div>
        }
    </section>
    <hr />
    <partial name="_PagesNavigation" view-data="ViewData" />
</main>

@section Scripts {
    <script src="~/js/search.js"></script>
    <script src="~/js/shareHeadache.js"></script>
}